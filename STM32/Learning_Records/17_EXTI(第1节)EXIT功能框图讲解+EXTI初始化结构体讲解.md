## 17_EXTI(第1节)EXIT功能框图讲解+EXTI初始化结构体讲解

1. EXTI简介
2. EXTI功能框图讲解
3. GPIO中断实验讲解

### 1.EXTI简介

EXTI：External interrupt / event controller	外部中断/事件控制器

​	管理了控制器的 20个中断/事件线。每个中断/事件线都对应有一个边沿检测器，可以实现输入信号的上升沿 检测和下降沿的检测。EXTI 可以实现对每个中断/事件线进行单独配置，可以单独配置为中断或者事件，以及触发事件的属性。 

​	例子流程：GPIO->EXIT->NVIC

### 2.EXTI功能框图讲解

![](pic/47.png)

#### **①输入线**

1. 输入线总共有多少，具体是哪一些？

   EXTI 有 20 个中断/事件线，每个 GPIO 都可以被设置为输入线，占用 EXTI0 至EXTI15，还有另外4根用于特定的外设事件。

   ![](pic/48.png)

   EXTI0 至 EXTI15 用于 GPIO，通过编程控制可以实现任意一个 GPIO 作为 EXTI 的输入源。

2. 通过配置哪个寄存器来选择？

   在STM32F103中文参考手册中8.4AFIO寄存器描述中的外部中断配置寄存器（AFIO_EXTICRx）1，2，3，4来选择。

   ![](pic/49.png)

   ![](pic/50.png)

#### ②边缘检测电路

边缘检测电路根据**上升沿触发选择寄存器(EXTI_RTSR)**和**下降沿触发选择寄存器(EXTI_FTSR)**对应位的设置来控制信号触发。

![](pic/51.png)

 **每一个根线都对应了这里面的一个位。**

边沿检测电路以输入线作为信号输入端，如果检测到有边沿跳变就输出有效信号 1 给编号 3 电路，否则输出无效信号0。而 EXTI_RTSR 和 EXTI_FTSR 两个寄存器可以控制器需要检测哪些类型的电平跳变过程，可以是只有上升沿触发、只有下降沿触发或者上升沿和下降沿都触发。 

#### ③或门电路

它一个输入来自编号 2 电路，另外一个输入来自软件中断事件寄存器(EXTI_SWIER)。

![](pic/52.png)

EXTI_SWIER 允许我们通过程序控制就可以启动中断/事件线，这在某些地方非常有用。我们知道或门的作用就是有 1 就为 1，所以这两个输入随便一个有有效信号 1 就可以输出 1 给编号 4 和编号 6 电路。 

#### ④与门电路

它一个输入是编号 3 电路，另外一个输入来自**中断屏蔽寄存器(EXTI_IMR)**。

![](pic/53.png)

与门电路要求输入都为 1 才输出 1，导致的结果是如果 EXTI_IMR 设置为 0 时，那不管编号 3 电路的输出信号是 1 还是 0，最终编号 4 电路输出的信号都为 0；如果 EXTI_IMR 设置为 1 时，最终编号 4 电路输出的信号才由编号 3 电路的输出信号决定，这样我们可以简单的控制 EXTI_IMR 来实现是否产生中断的目的。编号 4 电路输出的信号 会被保存到**挂起寄存器(EXTI_PR)**内，如果确定编号 4 电路输出为 1 就会把 EXTI_PR 对应位置 1。 

#### ⑤编号 5 是将 EXTI_PR 寄存器内容输出到 NVIC 内，从而实现系统中断事件控制。 

