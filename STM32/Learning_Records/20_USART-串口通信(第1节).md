## 20_USART-串口通信

1. 串口通信协议
2. STM32串口功能框图讲解
3. 代码讲解

### 1.串口通信协议

#### 串口通信协议简介

串口通讯(Serial Communication)是一种设备间非常常用的串行通讯方式。

**物理层通信常用的三个标准**

1. **RS232标准**

   ![](pic/63.png)

2. **USB转串口（TTL）**

   

3. **原生的串口转串口（TTL-TTL）**



### 2STM32串口功能框图讲解

通用同步异步收发器(Universal Synchronous Asynchronous Receiver and Transmitter)是一个串行通信设备，可以灵活地与外部设备进行全双工数据交换。

![](pic/65.png)

#### ①引脚的功能

**TX**：发送数据输出引脚。

**RX**：接收数据输入引脚。

**SW_RX**：数据接收引脚，只用于单线和智能卡模式，属于内部引脚，没有具体外部引脚。

**nRTS**：请求以发送(Request To Send)，n 表示低电平有效。如果使能 RTS 流控制，当

USART 接收器准备好接收新数据时就会将 nRTS 变成低电平；当接收寄存器已满时，

nRTS 将被设置为高电平。该引脚只适用于硬件流控制。

**nCTS**：清除以发送(Clear To Send)，n 表示低电平有效。如果使能 CTS 流控制，发送

器在发送下一帧数据之前会检测 nCTS 引脚，如果为低电平，表示可以发送数据，如果为

高电平则在发送完当前数据帧之后停止发送。该引脚只适用于硬件流控制。

**SCLK**：发送器时钟输出引脚。这个引脚仅适用于同步模式。

![](pic/66.png)

#### ②数据寄存器

USART 数据寄存器(USART_DR)只有低 9 位有效，并且第 9 位数据是否有效要取决于USART 控制寄存器 1(USART_CR1)的 **M** 位设置，当 M 位为 0 时表示 8 位数据字长，当 M位为 1 表示 9 位数据字长，我们一般使用 8 位数据字长。

USART_DR 包含了已发送的数据或者接收到的数据。**USART_DR 实际是包含了两个寄存器，一个专门用于发送的可写 TDR，一个专门用于接收的可读 RDR**。当进行发送操作时，往 USART_DR 写入数据会自动存储在 TDR 内；当进行读取操作时，向 USART_DR读取数据会自动提取 RDR 数据。

TDR 和 RDR 都是介于系统总线和移位寄存器之间。串行通信是一个位一个位传输的，发送时把 TDR 内容转移到发送移位寄存器，然后把移位寄存器数据每一位发送出去，接收时把接收到的每一位顺序保存在接收移位寄存器内然后才转移到 RDR。

![](pic/67.png)

![](pic/68.png)

#### ③控制器

USART 有专门控制发送的发送器、控制接收的接收器，还有唤醒单元、中断控制等等。使用 USART 之前需要向 USART_CR1 寄存器的 UE 位置 1 使能 USART，UE 位用来开启供给给串口的时钟。发送或者接收数据字长可选 8 位或 9 位，由 USART_CR1 的 M 位控制。

![](pic/69.png)

![](pic/70.png)

![](pic/71.png) 

